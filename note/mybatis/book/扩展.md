## Mybatis 学习扩展

##  多级映射返回JSON数据
在日常的开发中，接口的返回数据大多都是Json，以下也是一个很常见的json格式
```json
[
  {
    "addressee": "北京",
    "addressee_name": "yanghaiji",
    "addressee_phone": "1234565432",
    "senderVOList": [
      {
        "sender_add": null,
        "sender_name": "北京",
        "informationVOS": [
          {
            "ems_status": "0",
            "retreat_status": "0",
            "create_by": "admin",
            "create_date": "2019-11-02"
          }
        ]
      }
    ]
  },
  {
    "addressee": "shanghai",
    "addressee_name": "hiaji",
    "addressee_phone": "1234565432",
    "senderVOList": [
      {
        "sender_add": null,
        "sender_name": "shanghai",
        "informationVOS": [
          {
            "ems_status": "0",
            "retreat_status": "0",
            "create_by": "admin123",
            "create_date": "2019-11-02"
          }
        ]
      }
    ]
  },
  {
    "addressee": "北京",
    "addressee_name": "ji",
    "addressee_phone": "1234565432",
    "senderVOList": [
      {
        "sender_add": null,
        "sender_name": "北京",
        "informationVOS": [
          {
            "ems_status": "0",
            "retreat_status": "0",
            "create_by": "admin",
            "create_date": "2019-11-02"
          }
        ]
      }
    ]
  }
]
```
看到上边的json，您会想到，直接查询一下，在java代码进行循环拼接？实则不然，Mybatis为我们提供了很好的帮助，
细心的朋友会在[mybatis 结果映射](结果映射.md)中有所感悟，其实我们只需要利用到` <resultMap>` `<collection>`
等结果映射标签即可完成，不需要代码处理

首先我们写这样一段sql
```sql
<select id="findAll" resultMap="logisticsMap">
    SELECT
        addressee,
        addressee_name,
        addressee_phone,
        sender_add sender_name,
        ems_status,
        retreat_status,
        create_by,
        create_date
    FROM
        sys_logistics
</select>
```
根据您需要的结构编写实体类，这里略过，大家可以参考`source-code` 关系Mybatis的相关代码

然后开始编写`resultMap`
这里我只是三层的关系，更多的层次关系继续写就可以
```xml
<resultMap type="com.javayh.advanced.mybatis.vo.LogisticsVO" id="logisticsMap">
    <result property="addressee" column="addressee"/>
    <result property="addressee_name" column="addressee_name"/>
    <result property="addressee_phone" column="addressee_phone"/>
    <collection property="senderVOList"  resultMap = "senderVOListMap"/>
</resultMap>
<resultMap type="com.javayh.advanced.mybatis.vo.LogisticsSenderVO" id="senderVOListMap">
    <result property="sender_add" column="sender_add"/>
    <result property="sender_name" column="sender_name"/>
    <collection property="informationVOS"  resultMap = "informationVOSMap"/>
</resultMap>
<resultMap type="com.javayh.advanced.mybatis.vo.OtherInformationVO" id="informationVOSMap">
    <result property="create_by" column="create_by"/>
    <result property="create_date" column="create_date"/>
    <result property="retreat_status" column="retreat_status"/>
    <result property="ems_status" column="ems_status"/>
</resultMap>
```
最后测试
```java
@Test
void mapperMap() throws JsonProcessingException {
    List<LogisticsVO> all = testMapper.findAll();
    ObjectMapper objectMapper = new ObjectMapper();
    String s = objectMapper.writerWithDefaultPrettyPrinter().writeValueAsString(all);
    System.out.println(s);
}
```
![mybatismap](../../../doc/mybatis/mybatismap.png)